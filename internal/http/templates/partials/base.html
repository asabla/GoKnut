{{define "shared/head"}}
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Tailwind CSS via CDN -->
<script src="https://cdn.tailwindcss.com"></script>

<!-- HTMX -->
<script src="https://unpkg.com/htmx.org@1.9.12"></script>

<!-- Unified Tailwind Configuration -->
<script>
    tailwind.config = {
        darkMode: 'class',
        theme: {
            extend: {
                // Custom Breakpoints
                screens: {
                    'xs': '475px',
                    'sm': '640px',
                    'md': '768px',
                    'lg': '1024px',
                    'xl': '1280px',
                    '2xl': '1536px',
                    '3xl': '1920px',
                    '4xl': '2560px',
                },
                // Design Tokens: Colors
                colors: {
                    twitch: {
                        purple: '#9146FF',
                        'purple-dark': '#772CE8',
                        'purple-light': '#A970FF',
                        dark: '#18181B',
                        gray: '#1F1F23',
                        light: '#EFEFF1',
                    },
                    primary: {
                        50: '#F3E8FF',
                        100: '#E9D5FF',
                        200: '#D8B4FE',
                        300: '#C084FC',
                        400: '#A855F7',
                        500: '#9146FF',
                        600: '#772CE8',
                        700: '#6B21A8',
                        800: '#581C87',
                        900: '#3B0764',
                        950: '#1E0338',
                    },
                    surface: {
                        DEFAULT: '#1F1F23',
                        dark: '#18181B',
                        light: '#26262C',
                        hover: '#2D2D35',
                        border: '#3F3F46',
                    },
                    success: {
                        300: '#86EFAC',
                        400: '#4ADE80',
                        500: '#22C55E',
                        900: '#14532D',
                    },
                    warning: {
                        300: '#FDE047',
                        400: '#FACC15',
                        500: '#EAB308',
                        900: '#713F12',
                    },
                    error: {
                        300: '#FCA5A5',
                        400: '#F87171',
                        500: '#EF4444',
                        600: '#DC2626',
                        800: '#991B1B',
                        900: '#7F1D1D',
                    },
                },
                // Typography Scale
                fontSize: {
                    'xs': ['0.75rem', { lineHeight: '1rem' }],
                    'sm': ['0.875rem', { lineHeight: '1.25rem' }],
                    'base': ['1rem', { lineHeight: '1.5rem' }],
                    'lg': ['1.125rem', { lineHeight: '1.75rem' }],
                    'xl': ['1.25rem', { lineHeight: '1.75rem' }],
                    '2xl': ['1.5rem', { lineHeight: '2rem' }],
                    '3xl': ['1.875rem', { lineHeight: '2.25rem' }],
                },
                // Max-width for readable text
                maxWidth: {
                    'prose': '70ch',
                    'prose-wide': '80ch',
                    'content': '80rem',
                    'wide': '96rem',
                    'ultra': '120rem',
                },
                // Border Radius
                borderRadius: {
                    'sm': '0.25rem',
                    'DEFAULT': '0.375rem',
                    'md': '0.5rem',
                    'lg': '0.75rem',
                    'xl': '1rem',
                },
                // Box Shadow
                boxShadow: {
                    'glow': '0 0 20px rgb(145 70 255 / 0.3)',
                    'glow-sm': '0 0 10px rgb(145 70 255 / 0.2)',
                },
                // Animations
                animation: {
                    'fade-in': 'fadeIn 200ms ease-out',
                    'highlight': 'highlight 2s ease-out',
                },
                keyframes: {
                    fadeIn: {
                        '0%': { opacity: '0' },
                        '100%': { opacity: '1' },
                    },
                    highlight: {
                        '0%': { backgroundColor: 'rgba(145, 70, 255, 0.2)' },
                        '100%': { backgroundColor: 'transparent' },
                    },
                },
            },
        },
    }
</script>

<!-- Unified Custom Styles -->
<style type="text/tailwindcss">
    @layer base {
        :focus-visible {
            @apply outline-none ring-2 ring-primary-500 ring-offset-2 ring-offset-surface-dark;
        }
        
        html {
            scroll-behavior: smooth;
        }
        
        @media (prefers-reduced-motion: reduce) {
            html {
                scroll-behavior: auto;
            }
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
        
        ::-webkit-scrollbar {
            @apply w-2 h-2;
        }
        ::-webkit-scrollbar-track {
            @apply bg-surface-dark;
        }
        ::-webkit-scrollbar-thumb {
            @apply bg-gray-600 rounded-full hover:bg-gray-500;
        }
    }
    
    @layer utilities {
        .htmx-indicator {
            opacity: 0;
            transition: opacity 200ms ease-in;
        }
        .htmx-request .htmx-indicator,
        .htmx-request.htmx-indicator {
            opacity: 1;
        }
        
        .sse-updated {
            animation: highlight 2s ease-out;
        }
        .sse-new-message {
            animation: highlight 2s ease-out;
        }
        
        .measure {
            max-width: 70ch;
        }
        .measure-wide {
            max-width: 80ch;
        }
        
        .container-prose {
            @apply max-w-7xl mx-auto px-4 sm:px-6 lg:px-8;
        }
        
        .container-wide {
            @apply max-w-[120rem] mx-auto px-4 sm:px-6 lg:px-8 2xl:px-12 3xl:px-16;
        }
    }
    
    @layer components {
        .btn {
            @apply inline-flex items-center justify-center font-medium rounded-md transition-colors 
                   focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 
                   focus-visible:ring-primary-500 focus-visible:ring-offset-surface-dark
                   disabled:opacity-50 disabled:cursor-not-allowed;
        }
        .btn-sm {
            @apply px-2.5 py-1 text-xs;
        }
        .btn-md {
            @apply px-4 py-2 text-sm;
        }
        .btn-lg {
            @apply px-6 py-3 text-sm;
        }
        .btn-primary {
            @apply bg-primary-500 text-white shadow-sm hover:bg-primary-600 active:bg-primary-700;
        }
        .btn-secondary {
            @apply border border-gray-600 text-gray-300 bg-transparent 
                   hover:bg-surface-hover hover:text-white hover:border-gray-500;
        }
        .btn-ghost {
            @apply text-gray-300 hover:text-white hover:bg-surface-hover;
        }
        .btn-danger {
            @apply border border-error-600 text-error-400 bg-transparent
                   hover:bg-error-900/50 hover:text-error-300;
        }
        
        .input {
            @apply block w-full rounded-md bg-surface-dark border-gray-600 text-white shadow-sm 
                   placeholder:text-gray-500
                   focus:border-primary-500 focus:ring-primary-500
                   disabled:opacity-50 disabled:cursor-not-allowed;
        }
        .input-sm {
            @apply px-3 py-1.5 text-sm;
        }
        .input-md {
            @apply px-4 py-2 text-sm;
        }
        .input-lg {
            @apply px-4 py-3 text-sm;
        }
        
        .checkbox {
            @apply rounded bg-surface-dark border-gray-600 text-primary-500 
                   focus:ring-primary-500 focus:ring-offset-surface-dark;
        }
        
        .card {
            @apply bg-surface rounded-lg border border-surface-border;
        }
        .card-hover {
            @apply card hover:border-primary-500 transition-colors cursor-pointer;
        }
        .card-interactive {
            @apply card hover:border-primary-500 hover:shadow-glow-sm transition-all;
        }
        
        .badge {
            @apply inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium;
        }
        .badge-primary {
            @apply bg-primary-900 text-primary-200;
        }
        .badge-success {
            @apply bg-success-900 text-success-300;
        }
        .badge-warning {
            @apply bg-warning-900 text-warning-300;
        }
        .badge-error {
            @apply bg-error-900 text-error-300;
        }
        .badge-gray {
            @apply bg-gray-700 text-gray-300;
        }
        
        .table-container {
            @apply bg-surface rounded-lg border border-surface-border overflow-hidden;
        }
        .table {
            @apply min-w-full divide-y divide-gray-700;
        }
        .table-header {
            @apply bg-gray-800;
        }
        .table-header-cell {
            @apply px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider;
        }
        .table-body {
            @apply divide-y divide-gray-700;
        }
        .table-row {
            @apply hover:bg-surface-hover transition-colors;
        }
        .table-cell {
            @apply px-6 py-4 whitespace-nowrap;
        }
        
        .nav-link {
            @apply px-3 py-2 rounded-md text-sm font-medium transition-colors;
        }
        .nav-link-default {
            @apply text-gray-300 hover:text-white hover:bg-surface-hover;
        }
        .nav-link-active {
            @apply text-white bg-primary-500/20 border border-primary-500/50;
        }
        
        .empty-state {
            @apply py-12 text-center text-gray-500;
        }
        .empty-state-icon {
            @apply h-12 w-12 mx-auto mb-4 text-gray-600;
        }
        
        .loading-spinner {
            @apply animate-spin h-8 w-8 text-gray-400;
        }
        .loading-container {
            @apply p-6 text-center text-gray-500;
        }
        
        .skeleton {
            @apply animate-pulse bg-gray-700 rounded;
        }
        .skeleton-text {
            @apply skeleton h-4 w-full;
        }
    }
</style>
{{end}}

{{define "shared/nav"}}
<nav class="bg-surface border-b border-surface-border sticky top-0 z-50">
    <div class="container-prose">
        <div class="flex items-center justify-between h-16">
            <div class="flex items-center">
                <a href="/" class="flex-shrink-0">
                    <span class="text-primary-500 font-bold text-xl">GoKnut</span>
                </a>
                <div class="ml-10 flex items-baseline space-x-1">
                    <a href="/channels" class="nav-link {{if eq .ActivePage "channels"}}nav-link-active{{else}}nav-link-default{{end}}">Channels</a>
                    <a href="/users" class="nav-link {{if eq .ActivePage "users"}}nav-link-active{{else}}nav-link-default{{end}}">Users</a>
                    <a href="/messages" class="nav-link {{if eq .ActivePage "messages"}}nav-link-active{{else}}nav-link-default{{end}}">Messages</a>
                </div>
            </div>
            {{block "nav-right" .}}{{end}}
        </div>
    </div>
</nav>
{{end}}

{{define "shared/footer"}}
<footer class="bg-surface border-t border-surface-border mt-auto">
    <div class="container-prose py-4">
        <p class="text-center text-gray-500 text-sm">Twitch Chat Archiver & Explorer</p>
    </div>
</footer>
{{end}}

{{define "shared/sse-status"}}
<span id="sse-status-{{.ID}}" class="inline-flex items-center text-xs" data-testid="sse-status-{{.ID}}">
    <span id="sse-{{.ID}}-connected" class="hidden items-center text-success-400">
        <span class="relative flex h-1.5 w-1.5 mr-1">
            <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-success-400 opacity-75"></span>
            <span class="relative inline-flex rounded-full h-1.5 w-1.5 bg-success-500"></span>
        </span>
        Live
    </span>
    <span id="sse-{{.ID}}-idle" class="hidden items-center text-gray-500">
        <span class="h-1.5 w-1.5 rounded-full bg-gray-500 mr-1"></span>
        Idle
    </span>
    <span id="sse-{{.ID}}-reconnecting" class="hidden items-center text-warning-400">
        <svg class="animate-spin h-3 w-3 mr-1" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"></path>
        </svg>
        Reconnecting
    </span>
    <span id="sse-{{.ID}}-error" class="hidden items-center text-error-400">
        <svg class="h-3 w-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
        Offline
    </span>
</span>
{{end}}

{{define "shared/htmx-config"}}
<script>
    document.body.addEventListener('htmx:configRequest', function(evt) {
        // Add any global request configuration here
    });
    
    document.body.addEventListener('htmx:responseError', function(evt) {
        console.error('HTMX request error:', evt.detail);
    });
</script>
{{end}}
